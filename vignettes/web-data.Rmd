---
title: "Web data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Web data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette builds a small web corpus from a single search: discover URLs with `fetch_urls()`, then read page content with `read_urls()`. A few lines give you a filterable table of articles with linked titlesâ€”no sentence splitting or extra processing.

**Functions used:** `fetch_urls()` returns a data frame of search-result URLs and metadata (including `path_depth`). `read_urls()` takes a character vector of URLs and returns one row per text node (headings, paragraphs) with columns such as `url`, `h1_title`, `date`, and `text`. Using `path_depth` to keep only article-like URLs (see below) makes small corpus building straightforward.

**`path_depth`:** The number of path segments in the URL (e.g. `example.com/a` has depth 1, `example.com/a/b/c` has depth 3). Search results often include index pages, category pages, or shallow links. Filtering with `path_depth > 0` (or a higher threshold) keeps deeper, article-style pages and drops many non-article hits.

## Search and read

```{r web-urls, message=FALSE, warning=FALSE}
library(textpress)
library(dplyr)
library(DT)

web_urls <- textpress::fetch_urls(
  query       = "us polling on immigration",
  n_pages     = 4,
  date_filter = "m"
)
```

```{r web-text}
web_text <- web_urls |>
  filter(path_depth > 0) |>
  pull(url) |>
  textpress::read_urls(cores = 1)
```

```{r}
metas_dt <- web_text |>
  group_by(url) |>
  summarise(
    url       = first(url),
    h1_title  = first(h1_title),
    date      = first(date),
    source    = sub("^https?://([^/]+).*", "\\1", first(url)),
    .groups   = "drop"
  ) |>
  filter(!is.na(h1_title) & nzchar(trimws(h1_title))) |>
  arrange(desc(date)) |>
  mutate(
    title_link = paste0(
      '<a href="', url, '" target="_blank">', h1_title, '</a>'
    )
  )

DT::datatable(
  metas_dt |> select(date, source, title_link),
  options = list(columnDefs = list(
    list(targets = 2, orderable = FALSE)
  )),
  escape   = FALSE,
  rownames = FALSE
)
```
